{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\game/assets\\script\\game\\game.js"],"names":["require","FRAME_COUNT","cc","Class","extends","Component","properties","_heroId","_heroCarIndex","_opponentCarIndex","_plyaerIds","_counter","_frameCount","_distances","_offsetXMin","_offsetXMax","_presentY","_presentX","_waywidth","initOffsetXs","initOffsetY","_offsetXs","_accelerator","_changelane","running","trafficlightIndex","_destination","maskLayer","Node","roadNode","bg1","Sprite","bg2","startLine","redpoint","bluepoint","cars","default","type","heroArrow","_blocks","speedometer","ProgressBar","speedLabel","Label","speedupButton","Button","wheelButton","tipsLabel","trafficlight","trafficlights","audioBackground","url","AudioClip","audioDaoshu","AudioSource","audioWin","audioLose","onLoad","YYSDK","JYXStartGame","JYXFinishLoading","start","self","UI","setSwallow","ROAD_LENGTH","bindEvent","NETWORK","initProtocols","scheduleOnce","connect","WS_URL","interval","repeat","delay","schedule","isConnected","for_caller","s_user_heartbeat","reset","active","prepare","i","length","car","carScript","getComponent","setCarIndex","node","x","y","runAction","moveTo","heroCarScript","setCarTag","progress","string","countdown","console","log","stop","play","JYXPKStart","on","event","touch","getLocation","SPEED_HORIZON","eventFuncs","ENTER","detail","heroId","START","ownerId","opponentId","indexOf","FINISH","RACE","distance","RESULT","setSpeed","setCanMove","formatTime","time","s","Math","floor","ms","toString","substr","m","winnerId","audioEngine","show","ui","showTime","result","JYXPKFinish","BLOCK","_createBlock","prefabName","scriptName","blockData","updateData","push","blockType","eventName","eventFunc","director","genBlockDatas","randNum","UTIL","randInt","index","inRange","BLOCK_CONFIG","rangeData","speed","emit","BLOCK_SHOW_INTERVAL_MIN","BLOCK_SHOW_INTERVAL_MAX","adjustRoad","getSpeed","topBG","bottomBG","screenHeight","heroCar","blocksGC","block","blockSpeed","splice","getType","destroy","mapWeiYi","heroDistance","heroWeiYiY","heroWeiYiX","opponentWeiYiY","opponentWeiYiX","update","dt","canMove","setCanChangeLane","bomb","speedMax","getSpeedMax","getNowGear","BLOCK_SHOW_GEER","getCanChangeLane","changeSpeed","SPEED_UP_PER_FRAME","SPEED_DOWN_PER_FRAME","round","abs","opponentCar","getSpeedUpMax","s_racing_sync_data","s_racing_finish_game","onDestroy","off"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\game","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\n\r\nrequire(\"init\");\r\n\r\nvar FRAME_COUNT = 4;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n\r\n        _heroId: 0,\r\n        _heroCarIndex: 0,\r\n        _opponentCarIndex: 0,\r\n        _plyaerIds: [0, 0],\r\n        _counter: 0,\r\n\r\n        // 速度\r\n        _frameCount: 99999999,\r\n\r\n        _distances: [0, 0],\r\n\r\n        // 左右偏移坐标\r\n        _offsetXMin: -200,\r\n        _offsetXMax: 200,\r\n\r\n        //小地图偏移比例\r\n        _presentY: 710,\r\n        _presentX: 0,\r\n\r\n        //跑道宽度\r\n        _waywidth: 0,\r\n\r\n        initOffsetXs: [0, 0],\r\n        initOffsetY: -250,\r\n        _offsetXs: [0, 0],\r\n\r\n        // 是否在加速\r\n        _accelerator: false,\r\n        // 变道\r\n        _changelane: false,\r\n\r\n        // 游戏状态\r\n        running: false,\r\n\r\n        // 倒计时交通灯\r\n        trafficlightIndex: 0,\r\n\r\n        //终点\r\n        _destination: 0,\r\n        // ----------------------------------------\r\n        maskLayer: cc.Node,\r\n\r\n        // 道路\r\n        roadNode: cc.Node,\r\n        bg1: cc.Sprite,\r\n        bg2: cc.Sprite,\r\n        startLine: cc.Sprite,\r\n        redpoint: cc.Sprite,\r\n        bluepoint: cc.Sprite,\r\n\r\n        // 赛车\r\n        cars: {\r\n            default: [],\r\n            type: cc.Sprite,\r\n        },\r\n        heroArrow: cc.Sprite,\r\n\r\n        _blocks: [],\r\n\r\n        // 速度计\r\n        speedometer: cc.ProgressBar,\r\n        speedLabel: cc.Label,\r\n        speedupButton: cc.Button,\r\n        wheelButton: cc.Button,\r\n        tipsLabel: cc.Label,\r\n\r\n        // 交通灯\r\n        trafficlight: cc.Node,\r\n        trafficlights: {\r\n            default: [],\r\n            type: cc.Sprite,\r\n        },\r\n\r\n        // 声音\r\n        // ----------------------------------------\r\n        audioBackground: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n\r\n        audioDaoshu: {\r\n            type: cc.AudioSource,\r\n            default: null\r\n        },\r\n        audioWin: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        audioLose: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        }\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        YYSDK.JYXStartGame();\r\n        YYSDK.JYXFinishLoading();\r\n    },\r\n    \r\n    start() {\r\n        let self = this;\r\n\r\n        UI.setSwallow(this, this.maskLayer);\r\n        self.initOffsetXs = [-125, 125];\r\n        self.initOffsetY = -250;\r\n        self._offsetXs = [-125, 125];\r\n        self._destination = ROAD_LENGTH;\r\n        self._frameCount = 0;\r\n        self._waywidth = 200;\r\n        self._presentX = 30;\r\n        self.bindEvent();\r\n        // self.current = cc.audioEngine.play(self.audioBackground, true, 0.3);\r\n        // self.prepare();\r\n\r\n        // let HOST = \"127.0.0.1\";\r\n        // let HOST = \"120.78.95.221\";\r\n        // let PORT = 3000;\r\n\r\n        NETWORK.initProtocols();\r\n        this.scheduleOnce(function () {\r\n            // WS_URL = \"ws://127.0.0.1:10020\";\r\n            NETWORK.connect(WS_URL);\r\n        }, 2);\r\n\r\n        let interval = 5;\r\n        let repeat = 999999;\r\n        let delay = 5;\r\n        this.schedule(function() {\r\n            if (NETWORK.isConnected()) {\r\n                for_caller.s_user_heartbeat();\r\n            }\r\n        }, interval, repeat, delay);\r\n    },\r\n\r\n    reset() {\r\n        let self = this;\r\n        self.maskLayer.active = true;\r\n        self.prepare();\r\n    },\r\n\r\n    prepare() {\r\n        let self = this;\r\n\r\n        for (let i = 0; i < self.cars.length; i++) {\r\n            let car = self.cars[i];\r\n            let carScript = car.getComponent(\"car\");\r\n            carScript.setCarIndex(i + 1);\r\n            car.node.x = self.initOffsetXs[i];\r\n            car.node.y = -400;\r\n            car.node.runAction(cc.moveTo(0.5, car.node.x, self.initOffsetY));\r\n        }\r\n\r\n        self._distances = [0, 0];\r\n\r\n        self.heroArrow.node.x = self.initOffsetXs[self._heroCarIndex];\r\n        let heroCarScript = this.cars[self._heroCarIndex].getComponent(\"car\");\r\n        heroCarScript.setCarTag(self._heroCarIndex);\r\n\r\n        self.heroArrow.node.active = true;\r\n        self.startLine.node.y = -150;\r\n        self.speedometer.progress = 0;\r\n        self.tipsLabel.string = \"并驾齐驱\";\r\n\r\n        self.trafficlight.active = true;\r\n        for (let i = 0; i < self.trafficlights.length; i++) {\r\n            self.trafficlights[i].node.active = false;\r\n        }\r\n    },\r\n\r\n    countdown() {\r\n        let self = this;\r\n\r\n        self.maskLayer.active = false;\r\n        self.trafficlightIndex = 0;\r\n        self.running = false;\r\n\r\n        // 以秒为单位的时间间隔\r\n        let interval = 1;\r\n        // 重复次数\r\n        let repeat = 3;\r\n        // 开始延时\r\n        let delay = 1;\r\n\r\n        self.schedule(function () {\r\n            for (let i = 0; i < self.trafficlights.length; i++) {\r\n                self.trafficlights[i].node.active = (i === self.trafficlightIndex) ? true : false;\r\n            }\r\n            console.log(\"****play countdown\")\r\n            self.audioDaoshu.stop()\r\n            self.audioDaoshu.play()\r\n            self.trafficlightIndex += 1;\r\n\r\n            if (self.trafficlightIndex === 4) {\r\n                self.trafficlight.active = false;\r\n                self.heroArrow.node.active = false;\r\n                self.running = true;\r\n                //游戏开始\r\n                YYSDK.JYXPKStart();\r\n            }\r\n        }, interval, repeat, delay);\r\n    },\r\n\r\n    bindEvent() {\r\n        let self = this;\r\n        let heroCarScript = this.cars[self._heroCarIndex].getComponent(\"car\");\r\n\r\n        // 加油\r\n        self.speedupButton.node.on(\"touchstart\", function (event) {\r\n            self._accelerator = true;\r\n        }, self);\r\n\r\n        self.speedupButton.node.on(\"touchend\", function (event) {\r\n            self._accelerator = false;\r\n        }, self);\r\n\r\n        self.speedupButton.node.on(\"touchcancel\", function (event) {\r\n            self._accelerator = false;\r\n        }, self);\r\n\r\n        // 变道\r\n        self.wheelButton.node.on(\"touchstart\", function (event) {\r\n            // 233是轮盘向右的边界，149是向左的边界\r\n            var touch = event.getLocation();\r\n            if (touch.x >= 233) {\r\n                self._changelane = SPEED_HORIZON/60;\r\n            }\r\n            if (touch.x <= 149) {\r\n                self._changelane = -SPEED_HORIZON/60;\r\n            }\r\n        }, self);\r\n\r\n        self.wheelButton.node.on(\"touchmove\", function (event) {\r\n            var touch = event.getLocation();\r\n            if (touch.x >= 233) {\r\n                self._changelane = SPEED_HORIZON/60;\r\n            }\r\n            if (touch.x <= 149) {\r\n                self._changelane = -SPEED_HORIZON/60;\r\n            }\r\n        }, self);\r\n\r\n        self.wheelButton.node.on(\"touchend\", function (event) {\r\n            self._changelane = 0;\r\n        }, self);\r\n\r\n        self.wheelButton.node.on(\"touchcancel\", function (event) {\r\n            self._changelane = 0;\r\n        }, self);\r\n\r\n\r\n        // 事件\r\n        self.eventFuncs = {\r\n            ENTER: function (event) {\r\n                let detail = event.detail;\r\n                self._heroId = detail.heroId;\r\n            },\r\n            START: function (event) {\r\n                let detail = event.detail;\r\n                self._plyaerIds = [detail.ownerId, detail.opponentId];\r\n                self._heroCarIndex = self._plyaerIds.indexOf(self._heroId)\r\n                self._opponentCarIndex = self._heroCarIndex == 0 ? 1 : 0;\r\n                self.prepare();\r\n                self.countdown();\r\n            },\r\n            FINISH: function (event) {\r\n                self.reset();\r\n            },\r\n            RACE: function (event) {\r\n                let detail = event.detail;\r\n                self._distances[self._opponentCarIndex] = detail.distance;\r\n                self._offsetXs[self._opponentCarIndex] = detail.x;\r\n            },\r\n            RESULT: function (event) {\r\n                heroCarScript.setSpeed(0);\r\n                heroCarScript.setCanMove(false);\r\n\r\n                let detail = event.detail;\r\n                let formatTime = function (time) {\r\n                    var s = Math.floor(time / 1000);\r\n                    var ms = time % 1000;\r\n                    ms = ms.toString().substr(0, 2);\r\n                    var m = Math.floor(s / 60);\r\n                    s = s % 60;\r\n                    if (m > 99) {\r\n                        m = 99;\r\n                    }\r\n                    if (m < 10) {\r\n                        m = \"0\" + m.toString();\r\n                    }\r\n                    if (s < 10) {\r\n                        s = \"0\" + s.toString();\r\n                    }\r\n                    var time = m + \":\" + s + \":\" + ms;\r\n                    return time;\r\n                }\r\n                if (detail.winnerId == self._heroId) {\r\n                    self.running = false;\r\n                    cc.audioEngine.play(self.audioWin, false, 1);\r\n                    UI.show(null, \"prefab/result_win\", function (ui) {\r\n                        let time = formatTime(detail.time);\r\n                        ui.getComponent(\"result\").showTime(time);\r\n                    });\r\n                } else {\r\n                    self.running = false;\r\n                    cc.audioEngine.play(self.audioLose, false, 1);\r\n                    UI.show(null, \"prefab/result_lose\", function (ui) {\r\n                        let time = formatTime(detail.time);\r\n                        ui.getComponent(\"result\").showTime(time);\r\n                    });\r\n                }\r\n\r\n                //回传结果\r\n                self.scheduleOnce(function () {\r\n                    console.log(detail.result);\r\n                    YYSDK.JYXPKFinish(detail.result);\r\n                }, 2);\r\n            },\r\n            BLOCK: function (event) {\r\n                let detail = event.detail;\r\n                let _createBlock = function (prefabName, scriptName, blockData) {\r\n                    UI.show(self.roadNode, prefabName, function (ui) {\r\n                        ui.getComponent(scriptName).updateData(blockData);\r\n                        self._blocks.push(ui);\r\n\r\n                        ui.x = blockData[\"x\"];\r\n                        ui.y = blockData[\"y\"];\r\n                    });\r\n                }\r\n                var blockData = detail.blockData;\r\n                var blockType = blockData[\"type\"];\r\n                var prefabName = \"prefab/block\" + blockType;\r\n                var scriptName = \"block\" + blockType;\r\n                _createBlock(prefabName, scriptName, blockData);\r\n            },\r\n        };\r\n\r\n        for (let eventName in self.eventFuncs) {\r\n            let eventFunc = self.eventFuncs[eventName];\r\n            cc.director.on(eventName, eventFunc);\r\n        }\r\n    },\r\n\r\n    genBlockDatas() {\r\n        var self = this;\r\n\r\n        // console.log(self._frameCount);\r\n        if (self._frameCount > 0) {\r\n            self._frameCount -= 1;\r\n            return;\r\n        }\r\n\r\n        var randNum = UTIL.randInt(0, 100);\r\n        var index = UTIL.inRange(randNum, BLOCK_CONFIG);\r\n        \r\n        var rangeData = BLOCK_CONFIG[index];\r\n\r\n        var blockType = rangeData[\"blockType\"];\r\n        var speed = rangeData[\"speed\"];\r\n       \r\n        // let heroDistance = self._distances[self._heroCarIndex];\r\n        // console.log(\"heroDistance = \" + heroDistance + \",blocksNum = \" + self._blocks.length);\r\n        var blockData = {\r\n            type: blockType,\r\n            x: UTIL.randInt(-125, 125),\r\n            y: 700,\r\n            speed: speed,\r\n        };\r\n        cc.director.emit(\"BLOCK\", {\"blockData\": blockData});\r\n\r\n        if (self._frameCount <= 0) {\r\n            var randNum = UTIL.randInt(BLOCK_SHOW_INTERVAL_MIN, BLOCK_SHOW_INTERVAL_MAX);\r\n            self._frameCount = Math.floor(randNum/60);\r\n        }\r\n    },\r\n\r\n    adjustRoad() {\r\n        let self = this;\r\n        let heroCarScript = this.cars[self._heroCarIndex].getComponent(\"car\");\r\n        let speed = heroCarScript.getSpeed();\r\n\r\n        let topBG, bottomBG;\r\n        if (self.bg1.node.y < self.bg2.node.y) {\r\n            topBG = self.bg2;\r\n            bottomBG = self.bg1;\r\n        } else {\r\n            topBG = self.bg1;\r\n            bottomBG = self.bg2;\r\n        }\r\n\r\n        // TODO -1334 is Hard Code\r\n        let screenHeight = 1334;\r\n        bottomBG.node.y = bottomBG.node.y - speed;\r\n        topBG.node.y = bottomBG.node.y + screenHeight\r\n        if (bottomBG.node.y < -screenHeight) {\r\n            bottomBG.node.y = topBG.node.y + screenHeight;\r\n        }\r\n\r\n        self.startLine.node.y = self.startLine.node.y - speed;\r\n        if (self.startLine.node.y < -700) {\r\n            let heroCar = self.cars[self._heroCarIndex];\r\n            self.startLine.node.y = heroCar.node.y + (self._destination - self._distances[self._heroCarIndex]);\r\n        }\r\n\r\n        var blocksGC = []; // 障碍物GC...START\r\n\r\n        // 障碍物\r\n        for (let i = 0; i < self._blocks.length; i++) {\r\n            let block = self._blocks[i];\r\n            let blockSpeed = block.getComponent(\"block\").getSpeed();\r\n            block.y = block.y - speed + blockSpeed;\r\n            if (block.y < -1334 || block.y > 1334) {\r\n                blocksGC.push(block);\r\n                var index = self._blocks.indexOf(block);\r\n                self._blocks.splice(index,1);\r\n            }\r\n        }\r\n\r\n        if (blocksGC.length > 0) {\r\n            for(var i = 0;i < blocksGC.length;i ++) {\r\n                var block = blocksGC[i];\r\n                if (block.getComponent(\"block\").getType() == 2) continue;\r\n                block.destroy();\r\n            }\r\n        }\r\n\r\n        blocksGC = [];\r\n        // 障碍物GC...DONE\r\n    },\r\n\r\n    mapWeiYi(heroDistance, heroCar) {\r\n        let self = this;\r\n        var heroWeiYiY = heroDistance / self._destination * self._presentY;\r\n        var heroWeiYiX = heroCar.node.x / self._waywidth * self._presentX;\r\n        var opponentWeiYiY = self._distances[self._opponentCarIndex] / self._destination * self._presentY;\r\n        var opponentWeiYiX = self._offsetXs[self._opponentCarIndex] / self._waywidth * self._presentX;\r\n        if (self._heroCarIndex == 0) {\r\n            //-350是本来Y轴的偏移量\r\n            self.redpoint.node.y = -350 + heroWeiYiY;\r\n            self.redpoint.node.x = heroWeiYiX;\r\n            self.bluepoint.node.y = -350 + opponentWeiYiY;\r\n            self.bluepoint.node.x = opponentWeiYiX;\r\n        }\r\n        if (self._heroCarIndex == 1) {\r\n            self.bluepoint.node.y = -350 + heroWeiYiY;\r\n            self.bluepoint.node.x = heroWeiYiX;\r\n            self.redpoint.node.y = -350 + opponentWeiYiY;\r\n            self.redpoint.node.x = opponentWeiYiX;\r\n        }\r\n    },\r\n\r\n    update(dt) {\r\n        let self = this;\r\n        let heroCarScript = this.cars[self._heroCarIndex].getComponent(\"car\");\r\n        //添加canMove限制碰撞后不可移动\r\n        var  canMove = true;\r\n        let x = this.cars[self._heroCarIndex].node.x;\r\n        if (x <= self._offsetXMin || x >= self._offsetXMax) {\r\n            heroCarScript.setCanChangeLane(false);\r\n            heroCarScript.bomb();\r\n        }\r\n\r\n        if (self.running === false) return;\r\n\r\n        let speed = heroCarScript.getSpeed();\r\n        let speedMax = heroCarScript.getSpeedMax();\r\n\r\n        if (heroCarScript.getNowGear() > BLOCK_SHOW_GEER) {\r\n            self.genBlockDatas();\r\n        }\r\n        if (heroCarScript.getCanChangeLane() == false) {\r\n            canMove = false;\r\n            // console.log(\"不许动\")\r\n        }\r\n        if (self._accelerator && canMove) {\r\n            heroCarScript.changeSpeed(SPEED_UP_PER_FRAME);\r\n        } else {\r\n            if (speed > 0) {\r\n                heroCarScript.changeSpeed(SPEED_DOWN_PER_FRAME);\r\n            }\r\n        }\r\n        speed = heroCarScript.getSpeed();\r\n\r\n        self.adjustRoad();\r\n\r\n        // 更新距离\r\n        let heroDistance = self._distances[self._heroCarIndex];\r\n        heroDistance += speed;\r\n        self._distances[self._heroCarIndex] = heroDistance;\r\n        let distance = heroDistance - self._distances[self._opponentCarIndex];\r\n        if (distance === 0) {\r\n            self.tipsLabel.string = \"齐驱并驾\"\r\n        } else if (distance > 0) {\r\n            self.tipsLabel.string = \"领先\" + Math.round(distance / 100) + \"米\";\r\n        } else {\r\n            self.tipsLabel.string = \"落后\" + Math.abs(Math.round(distance / 100)) + \"米\";\r\n        }\r\n\r\n        // 变道控制\r\n        let heroCar = self.cars[self._heroCarIndex];\r\n        if (self._changelane !== 0 && (heroCarScript.getCanChangeLane() != false)) {\r\n            let x = heroCar.node.x;\r\n            x += self._changelane;\r\n            x = x < self._offsetXMin ? self._offsetXMin : x;\r\n            x = x > self._offsetXMax ? self._offsetXMax : x;\r\n            heroCar.node.x = x;\r\n        }\r\n\r\n        let opponentCar = self.cars[self._opponentCarIndex];\r\n        opponentCar.node.x = self._offsetXs[self._opponentCarIndex];\r\n        opponentCar.node.y = heroCar.node.y - distance;\r\n        self.mapWeiYi(heroDistance, heroCar);\r\n\r\n        // 速度计\r\n        self.speedometer.progress = speed / heroCarScript.getSpeedUpMax();\r\n        self.speedLabel.string = Math.floor(speed * 3) + \"\";\r\n\r\n        if (speed != 0) {\r\n            for_caller.s_racing_sync_data(heroDistance, heroCar.node.x);\r\n        }\r\n\r\n        // 每FRAME_COUNT帧重置一下计数器，代表FRAME_COUNT帧可以发一次数据\r\n        self._counter += 1;\r\n        // 如果速度为0也需要重置一下\r\n        if (speed == 0 || self._counter == FRAME_COUNT) {\r\n            self._counter = 0;\r\n        }\r\n\r\n        if (heroDistance >= self._destination) {\r\n            self.running = false;\r\n            for_caller.s_racing_finish_game();\r\n        }\r\n    },\r\n\r\n    onDestroy: function () {\r\n        let self = this;\r\n        for (let eventName in self.eventFuncs) {\r\n            let eventFunc = self.eventFuncs[eventName];\r\n            cc.director.off(eventName, eventFunc);\r\n        }\r\n\r\n        // if (this.current !== \"undefined\") {\r\n        //     cc.audioEngine.stop(this.current);\r\n        // }\r\n    },\r\n});\r\n"]}