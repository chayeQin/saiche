{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\game/assets\\script\\game\\block4.js"],"names":["BLOCK","require","cc","Class","extends","clsBlock","properties","touchAI","targetX","changeLane","touchX","time","time2","selfX","audioHorn","type","AudioSource","default","start","director","getCollisionManager","enabled","onCollisionEnter","other","self","name","substring","heroCarScript","node","getComponent","tag","play","x","t","getType","cfg","BLOCK_CONFIG","horiMax","UTIL","randInt","horiLenMin","horiLenMax","audioCollision","nowSpeed","getSpeed","gearNow","getNowGear","shiftBigX","BIG_EXPLODE_PER_MIN_X","BIG_EXPLODE_PER_MAX_X","shiftSmallX","SMALL_EXPLODE_PER_MIN_X","SMALL_EXPLODE_PER_MAX_X","SMALL_EXPLODE_TIME_PARAM","nodeRotateAction","SMALL_COLLIDE_ROTATE_DT2","SMALL_COLLIDE_ROTATE2","rollBigOrSmall","setSpeed","BIG_EXPLODE_SPEED","BIG_EXPLODE_X_TIME_PARAM","setCanChangeLane","leftBigRoll","playBigCrashSound","playSmallCrashSound","SMALL_COLLIDE_ROTATE","SMALL_EXPLODE_PARAM","rightBigRoll","update","dt","changeX","changeSpeed","Math","abs","getHorizonSpeed"],"mappings":"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","file":"block4.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\game","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\nvar BLOCK = require(\"block\");\r\n\r\ncc.Class({\r\n    extends: BLOCK.clsBlock,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        touchAI: false,\r\n        targetX: 0,\r\n        changeLane: 5,\r\n        touchX: 0,\r\n        time: 0,\r\n        time2: 0,\r\n        selfX: 0,\r\n        audioHorn: {\r\n            type: cc.AudioSource,\r\n            default: null\r\n        },\r\n\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start () {\r\n        cc.director.getCollisionManager().enabled = true;\r\n    },\r\n\r\n    onCollisionEnter: function (other, self) {\r\n        if (other.name.substring(0, 3) != \"car\") return;\r\n\r\n        this.heroCarScript = other.node.getComponent(\"car\");\r\n        \r\n        if (self.tag == 1 && this.touchAI == false) {\r\n            this.audioHorn.play();\r\n            this.touchAI = true;\r\n            this.selfX = this.node.x;\r\n            this.targetX = other.node.x;\r\n            var t = this.getType();\r\n            var cfg = BLOCK_CONFIG[t-1];\r\n            this.horiMax = UTIL.randInt(cfg.horiLenMin, cfg.horiLenMax); \r\n        }\r\n\r\n        if (self.tag == 0) {\r\n            this.audioCollision.play();\r\n            var nowSpeed = this.heroCarScript.getSpeed();\r\n\r\n            if (nowSpeed  > 72) {\r\n                nowSpeed = 72;\r\n            }\r\n\r\n            var gearNow = this.heroCarScript.getNowGear();\r\n            var shiftBigX = UTIL.randInt(BIG_EXPLODE_PER_MIN_X, BIG_EXPLODE_PER_MAX_X);\r\n            var shiftSmallX = UTIL.randInt(SMALL_EXPLODE_PER_MIN_X, SMALL_EXPLODE_PER_MAX_X);\r\n            this.time = gearNow * SMALL_EXPLODE_TIME_PARAM;\r\n\r\n            if (this.selfX > this.targetX) {\r\n                this.touchX = - shiftSmallX;\r\n                this.nodeRotateAction(self.node, SMALL_COLLIDE_ROTATE_DT2, SMALL_COLLIDE_ROTATE2, 1);\r\n                this.nodeRotateAction(self.node, SMALL_COLLIDE_ROTATE_DT2, -SMALL_COLLIDE_ROTATE2, 1);\r\n                if (this.rollBigOrSmall(gearNow) == true) {\r\n                    this.heroCarScript.setSpeed(BIG_EXPLODE_SPEED);\r\n                    this.time2 = gearNow * BIG_EXPLODE_X_TIME_PARAM;\r\n                    this.touchX = - shiftBigX;\r\n                    this.heroCarScript.setCanChangeLane(false);\r\n                    this.leftBigRoll(other.node, this.heroCarScript);\r\n                    this.heroCarScript.playBigCrashSound();\r\n                } else {\r\n                    this.heroCarScript.playSmallCrashSound();\r\n                    this.nodeRotateAction(other.node, 0.3, -SMALL_COLLIDE_ROTATE, 1);\r\n                    this.nodeRotateAction(other.node, 0.3, SMALL_COLLIDE_ROTATE, 1);\r\n                    this.heroCarScript.setSpeed(nowSpeed - (SMALL_EXPLODE_PARAM * gearNow));\r\n                }\r\n            } else {\r\n                this.touchX = shiftSmallX;\r\n                this.nodeRotateAction(self.node, SMALL_COLLIDE_ROTATE_DT2, -SMALL_COLLIDE_ROTATE2, 1);\r\n                this.nodeRotateAction(self.node, SMALL_COLLIDE_ROTATE_DT2, SMALL_COLLIDE_ROTATE2, 1);\r\n                if (this.rollBigOrSmall(gearNow) == true) {\r\n                    this.heroCarScript.setSpeed(BIG_EXPLODE_SPEED);\r\n                    this.time2 = gearNow * BIG_EXPLODE_X_TIME_PARAM;\r\n                    this.touchX = shiftBigX;\r\n                    this.heroCarScript.setCanChangeLane(false);\r\n                    this.rightBigRoll(other.node, this.heroCarScript);\r\n                    this.heroCarScript.playBigCrashSound();\r\n\r\n                } else {\r\n                    this.heroCarScript.playSmallCrashSound();\r\n                    this.nodeRotateAction(other.node, 0.3, SMALL_COLLIDE_ROTATE, 1);\r\n                    this.nodeRotateAction(other.node, 0.3, -SMALL_COLLIDE_ROTATE, 1);\r\n                    this.heroCarScript.setSpeed(nowSpeed - (SMALL_EXPLODE_PARAM * gearNow));\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    update (dt) {\r\n        if (this.touchAI == false) {\r\n            return;\r\n        }\r\n        if (this.time > 0) {\r\n            this.heroCarScript.changeX(this.touchX);\r\n            this.time --;\r\n        }\r\n        if (this.time2 > 0) {\r\n            this.heroCarScript.changeSpeed(-12);\r\n            this.time2 --;\r\n        }\r\n        if (this.node.x == this.targetX) {\r\n            return;\r\n        }\r\n        if (Math.abs(this.node.x - this.targetX) < this.changeLane) {\r\n            this.node.x = this.targetX;\r\n            return;\r\n        }\r\n\r\n        if (Math.abs(this.node.x - this.selfX) < this.horiMax)\r\n        {\r\n            if (this.node.x > this.targetX) {\r\n                this.node.x -= this.getHorizonSpeed();\r\n            } else {\r\n                this.node.x += this.getHorizonSpeed();\r\n            }\r\n        }\r\n        \r\n    },\r\n});\r\n"]}