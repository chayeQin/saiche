require=function e(t,o,n){function i(a,c){if(!o[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=o[a]={exports:{}};t[a][0].call(d.exports,function(e){var o=t[a][1][e];return i(o||e)},d,d.exports,e,t,o,n)}return o[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({GameConfig:[function(e,t,o){"use strict";cc._RF.push(t,"1ed37EiSaxFm56JpSMF7bud","GameConfig"),window.BLOCK_CONFIG=[{blockType:1,checkWidth:0,checkHeight:0,horiSpeed:0,horiLenMin:0,horiLenMax:0,limit:5,speed:0},{blockType:2,checkWidth:0,checkHeight:0,horiSpeed:0,horiLenMin:0,horiLenMax:0,limit:10,speed:0},{blockType:3,checkWidth:0,checkHeight:0,horiSpeed:0,horiLenMin:0,horiLenMax:0,limit:60,speed:20},{blockType:4,checkWidth:500,checkHeight:500,horiSpeed:300,horiLenMin:100,horiLenMax:150,limit:80,speed:20},{blockType:5,checkWidth:400,checkHeight:400,horiSpeed:300,horiLenMin:100,horiLenMax:400,limit:100,speed:20}],window.SPEED_UP_TIME=5e3,window.BLOCK_SHOW_GEER=3,window.BLOCK_SHOW_INTERVAL_MIN=2500,window.BLOCK_SHOW_INTERVAL_MAX=4e3,window.SPEED_UP_PER_FRAME=.5,window.SPEED_DOWN_PER_FRAME=-.9,window.SPEED_HORIZON=400,window.ROAD_LENGTH=12e4,window.COLLIDE_GEAR=5,window.SPEED_UP_PER_GEAR=6,window.MAX_GEAR=9,window.TEST_ROOM_ID=5,window.EXPLODE_BLINK_DT=1,window.EXPLODE_BLINK_TIME=3,window.EXPLODE_PRE_TIME=.1,window.BIG_EXPLODE_SPEED=24,window.SMALL_EXPLODE_PARAM=1,window.BIG_EXPLODE_X_TIME_PARAM=4,window.BIG_EXPLODE_PER_MIN_X=10,window.BIG_EXPLODE_PER_MAX_X=16,window.SMALL_EXPLODE_TIME_PARAM=4,window.SMALL_EXPLODE_PER_MIN_X=6,window.SMALL_EXPLODE_PER_MAX_X=9,window.SMALL_COLLIDE_ROTATE=30,window.SMALL_COLLIDE_ROTATE2=20,window.SMALL_COLLIDE_ROTATE_DT2=.1,cc._RF.pop()},{}],binding:[function(e,t,o){"use strict";cc._RF.push(t,"810d4fbZ1dJoaw72eQW5umt","binding"),for_maker.c_hello=function(e){},for_maker.c_login_version=function(e){var t=YYSDK.getPlayer();console.log(t),t?for_caller.s_login_player_create(t.name,t.uid):for_caller.s_login_player_create("测试玩家","0")},for_maker.c_login_sign_check=function(e){var t=YYSDK.getPlayer();t&&for_caller.s_login_player_create(t.name,t.uid)},for_maker.c_login_player_create=function(e){for_caller.s_login_player_enter(e),cc.director.emit("ENTER",{heroId:e})},for_maker.c_user=function(e){var t=YYSDK.getGameData();t?for_caller.s_racing_start_game(t.roomid,t.gameid,t.channelid):for_caller.s_racing_start_game(TEST_ROOM_ID,"saiche","test");var o=YYSDK.getSignData();o?for_caller.s_login_sign_check(o.timestamp,o.nonstr,o.post_data,o.sign):for_caller.s_login_player_create("测试玩家","0")},for_maker.c_racing_start_game=function(e,t){console.log("c_racing_start_game",e,t),cc.director.emit("START",{ownerId:e,opponentId:t})},for_maker.c_racing_sync_data=function(e,t){cc.director.emit("RACE",{distance:e,x:t})},for_maker.c_racing_block_data=function(e){cc.director.emit("BLOCK",{blockDatas:e})},for_maker.c_racing_finish_game=function(e,t,o){cc.director.emit("RESULT",{winnerId:e,time:t,result:o})},cc._RF.pop()},{}],block1:[function(e,t,o){"use strict";cc._RF.push(t,"965caOjWjtDt5Y+fGwsdsC1","block1");var n=e("block");cc.Class({extends:n.clsBlock,properties:{time:0},start:function(){cc.director.getCollisionManager().enabled=!0},onCollisionEnter:function(e,t){"car"==e.name.substring(0,3)&&(this.heroCarScript=e.node.getComponent("car"),this.time=3*this.heroCarScript.getNowGear())},update:function(e){this.time>0&&(this.heroCarScript.changeSpeed(-4),this.time--)}}),cc._RF.pop()},{block:"block"}],block2:[function(e,t,o){"use strict";cc._RF.push(t,"9aa9cKNPV9Gl4V2yNIBP0Fm","block2");var n=e("block");cc.Class({extends:n.clsBlock,properties:{time:0},start:function(){cc.director.getCollisionManager().enabled=!0},onCollisionEnter:function(e,t){"car"==e.name.substring(0,3)&&(this.heroCarScript=e.node.getComponent("car"),this.heroCarScript.setSpeed(this.heroCarScript.getSpeedUpMax()),this.heroCarScript.setSpeedUpMax(),this.time=SPEED_UP_TIME/60)},update:function(e){this.time>0&&--this.time<=0&&this.heroCarScript.setSpeedMax()}}),cc._RF.pop()},{block:"block"}],block3:[function(e,t,o){"use strict";cc._RF.push(t,"0b32cychhNGEYaJPkzcZUQR","block3");var n=e("block");cc.Class({extends:n.clsBlock,properties:{targetX:0,changeLane:5,touchX:0,time:0,time2:0},start:function(){cc.director.getCollisionManager().enabled=!0},onCollisionEnter:function(e,t){if("car"==e.name.substring(0,3)&&(this.heroCarScript=e.node.getComponent("car"),this.targetX=e.node.x,0==t.tag)){this.audioCollision.play();var o=this.heroCarScript.getSpeed();o>72&&(o=72);var n=this.heroCarScript.getNowGear(),i=UTIL.randInt(20,40),r=UTIL.randInt(10,15);this.time=2.5*n,this.node.x>this.targetX?(this.touchX=-r/2.5,1==this.rollBigOrSmall(n)?(this.heroCarScript.playBigCrashSound(),this.heroCarScript.setSpeed(0),this.time2=2*n,this.touchX=-i/2.5,this.heroCarScript.setCanChangeLane(!1),this.leftBigRoll(e.node,this.heroCarScript)):(this.heroCarScript.playSmallCrashSound(),this.nodeRotateAction(e.node,.3,60,1),this.nodeRotateAction(e.node,.3,-60,1),this.heroCarScript.setSpeed(o-5*n))):(this.touchX=r/2.5,1==this.rollBigOrSmall(n)?(this.heroCarScript.playBigCrashSound(),this.heroCarScript.setSpeed(0),this.time2=2*n,this.touchX=i/2.5,this.heroCarScript.setCanChangeLane(!1),this.rightBigRoll(e.node,this.heroCarScript)):(this.heroCarScript.playSmallCrashSound(),this.nodeRotateAction(e.node,.3,-60,1),this.nodeRotateAction(e.node,.3,60,1),this.heroCarScript.setSpeed(o-5*n)))}},update:function(e){this.time>0&&(this.heroCarScript.changeX(this.touchX),this.time--),this.time2>0&&(this.heroCarScript.changeSpeed(-12),this.time2--)}}),cc._RF.pop()},{block:"block"}],block4:[function(e,t,o){"use strict";cc._RF.push(t,"0fef6NKb3FIUqy5JkEoHUYn","block4");var n=e("block");cc.Class({extends:n.clsBlock,properties:{touchAI:!1,targetX:0,changeLane:5,touchX:0,time:0,time2:0,selfX:0,audioHorn:{type:cc.AudioSource,default:null}},start:function(){cc.director.getCollisionManager().enabled=!0},onCollisionEnter:function(e,t){if("car"==e.name.substring(0,3)){if(this.heroCarScript=e.node.getComponent("car"),1==t.tag&&0==this.touchAI){this.audioHorn.play(),this.touchAI=!0,this.selfX=this.node.x,this.targetX=e.node.x;var o=this.getType(),n=BLOCK_CONFIG[o-1];this.horiMax=UTIL.randInt(n.horiLenMin,n.horiLenMax)}if(0==t.tag){this.audioCollision.play();var i=this.heroCarScript.getSpeed();i>72&&(i=72);var r=this.heroCarScript.getNowGear(),a=UTIL.randInt(BIG_EXPLODE_PER_MIN_X,BIG_EXPLODE_PER_MAX_X),c=UTIL.randInt(SMALL_EXPLODE_PER_MIN_X,SMALL_EXPLODE_PER_MAX_X);this.time=r*SMALL_EXPLODE_TIME_PARAM,this.selfX>this.targetX?(this.touchX=-c,this.nodeRotateAction(t.node,SMALL_COLLIDE_ROTATE_DT2,SMALL_COLLIDE_ROTATE2,1),this.nodeRotateAction(t.node,SMALL_COLLIDE_ROTATE_DT2,-SMALL_COLLIDE_ROTATE2,1),1==this.rollBigOrSmall(r)?(this.heroCarScript.setSpeed(BIG_EXPLODE_SPEED),this.time2=r*BIG_EXPLODE_X_TIME_PARAM,this.touchX=-a,this.heroCarScript.setCanChangeLane(!1),this.leftBigRoll(e.node,this.heroCarScript),this.heroCarScript.playBigCrashSound()):(this.heroCarScript.playSmallCrashSound(),this.nodeRotateAction(e.node,.3,-SMALL_COLLIDE_ROTATE,1),this.nodeRotateAction(e.node,.3,SMALL_COLLIDE_ROTATE,1),this.heroCarScript.setSpeed(i-SMALL_EXPLODE_PARAM*r))):(this.touchX=c,this.nodeRotateAction(t.node,SMALL_COLLIDE_ROTATE_DT2,-SMALL_COLLIDE_ROTATE2,1),this.nodeRotateAction(t.node,SMALL_COLLIDE_ROTATE_DT2,SMALL_COLLIDE_ROTATE2,1),1==this.rollBigOrSmall(r)?(this.heroCarScript.setSpeed(BIG_EXPLODE_SPEED),this.time2=r*BIG_EXPLODE_X_TIME_PARAM,this.touchX=a,this.heroCarScript.setCanChangeLane(!1),this.rightBigRoll(e.node,this.heroCarScript),this.heroCarScript.playBigCrashSound()):(this.heroCarScript.playSmallCrashSound(),this.nodeRotateAction(e.node,.3,SMALL_COLLIDE_ROTATE,1),this.nodeRotateAction(e.node,.3,-SMALL_COLLIDE_ROTATE,1),this.heroCarScript.setSpeed(i-SMALL_EXPLODE_PARAM*r)))}}},update:function(e){0!=this.touchAI&&(this.time>0&&(this.heroCarScript.changeX(this.touchX),this.time--),this.time2>0&&(this.heroCarScript.changeSpeed(-12),this.time2--),this.node.x!=this.targetX&&(Math.abs(this.node.x-this.targetX)<this.changeLane?this.node.x=this.targetX:Math.abs(this.node.x-this.selfX)<this.horiMax&&(this.node.x>this.targetX?this.node.x-=this.getHorizonSpeed():this.node.x+=this.getHorizonSpeed())))}}),cc._RF.pop()},{block:"block"}],block5:[function(e,t,o){"use strict";cc._RF.push(t,"6674b06ccpNDaZ1Iv8QPwiB","block5");var n=e("block");cc.Class({extends:n.clsBlock,properties:{touchAI:!1,targetX:0,changeLane:10,touchX:0,time:0,time2:0,selfX:0,audioHorn:{type:cc.AudioSource,default:null}},start:function(){cc.director.getCollisionManager().enabled=!0},onCollisionEnter:function(e,t){if("car"==e.name.substring(0,3)){this.heroCarScript=e.node.getComponent("car");var o=this.heroCarScript.getNowGear();if(1==t.tag&&0==this.touchAI&&o>=COLLIDE_GEAR){this.touchAI=!0,this.selfX=this.node.x,this.targetX=e.node.x;var n=this.getType(),i=BLOCK_CONFIG[n-1];this.audioHorn.play(),this.horiMax=UTIL.randInt(i.horiLenMin,i.horiLenMax)}if(0==t.tag){this.audioCollision.play();var r=this.heroCarScript.getSpeed();r>72&&(r=72);var a=this.heroCarScript.getNowGear(),c=UTIL.randInt(BIG_EXPLODE_PER_MIN_X,BIG_EXPLODE_PER_MAX_X),s=UTIL.randInt(SMALL_EXPLODE_PER_MIN_X,SMALL_EXPLODE_PER_MAX_X);this.time=a*SMALL_EXPLODE_TIME_PARAM,this.selfX>this.targetX?(this.touchX=-s,this.nodeRotateAction(t.node,SMALL_COLLIDE_ROTATE_DT2,SMALL_COLLIDE_ROTATE2,1),this.nodeRotateAction(t.node,SMALL_COLLIDE_ROTATE_DT2,-SMALL_COLLIDE_ROTATE2,1),1==this.rollBigOrSmall(a)?(this.heroCarScript.setSpeed(BIG_EXPLODE_SPEED),this.time2=a*BIG_EXPLODE_X_TIME_PARAM,this.touchX=-c,this.heroCarScript.setCanChangeLane(!1),this.leftBigRoll(e.node,this.heroCarScript),this.heroCarScript.playBigCrashSound()):(this.heroCarScript.playSmallCrashSound(),this.nodeRotateAction(e.node,.3,-SMALL_COLLIDE_ROTATE,1),this.nodeRotateAction(e.node,.3,SMALL_COLLIDE_ROTATE,1),this.heroCarScript.setSpeed(r-SMALL_EXPLODE_PARAM*a))):(this.touchX=s,this.nodeRotateAction(t.node,SMALL_COLLIDE_ROTATE_DT2,SMALL_COLLIDE_ROTATE2,1),this.nodeRotateAction(t.node,SMALL_COLLIDE_ROTATE_DT2,-SMALL_COLLIDE_ROTATE2,1),1==this.rollBigOrSmall(a)?(this.heroCarScript.setSpeed(BIG_EXPLODE_SPEED),this.time2=a*BIG_EXPLODE_X_TIME_PARAM,this.touchX=c,this.heroCarScript.setCanChangeLane(!1),this.rightBigRoll(e.node,this.heroCarScript),this.heroCarScript.playBigCrashSound()):(this.heroCarScript.playSmallCrashSound(),this.nodeRotateAction(e.node,.3,SMALL_COLLIDE_ROTATE,1),this.nodeRotateAction(e.node,.3,-SMALL_COLLIDE_ROTATE,1),this.nodeRotateAction(t.node,.3,-SMALL_COLLIDE_ROTATE2,1),this.nodeRotateAction(t.node,.3,SMALL_COLLIDE_ROTATE2,1),this.heroCarScript.setSpeed(r-SMALL_EXPLODE_PARAM*a)))}}},update:function(e){0!=this.touchAI&&(this.time>0&&(this.heroCarScript.changeX(this.touchX),this.time--),this.time2>0&&(this.heroCarScript.changeSpeed(-12),this.time2--),this.node.x!=this.targetX&&(Math.abs(this.node.x-this.targetX)<this.changeLane?this.node.x=this.targetX:Math.abs(this.node.x-this.selfX)<this.horiMax&&(this.node.x>this.targetX?this.node.x-=this.getHorizonSpeed():this.node.x+=this.getHorizonSpeed())))}}),cc._RF.pop()},{block:"block"}],block:[function(e,t,o){"use strict";cc._RF.push(t,"18fc9oOvg1GnIDnJWJ9GRJC","block");var n=cc.Class({extends:cc.Component,properties:{_type:0,_x:0,_y:0,_speed:0,_horizonSpeed:0,heroCarScript:null,audioCollision:{type:cc.AudioSource,default:null}},start:function(){},getType:function(){return this._type},setType:function(e){this._type=e},getX:function(){return this._x},setX:function(e){this._x=e},getY:function(){return this._y},setY:function(e){this._y=e},getSpeed:function(){return this._speed},setSpeed:function(e){this._speed=e},getHorizonSpeed:function(){return this._horizonSpeed},updateData:function(e){this.setType(e.type),this.setX(e.x),this.setY(e.y),this.setSpeed(e.speed);var t=this.node.getComponents(cc.BoxCollider),o=BLOCK_CONFIG[e.type-1];if(o){this._horizonSpeed=o.horiSpeed/60;for(i=0;i<t.length;++i){var n=t[i];if(1==n.tag){n.size.width=o.checkWidth,n.size.height=o.checkHeight;break}}}for(var t=this.node.getComponents(cc.BoxCollider),i=0;i<t.length;++i){var r=t[i];if(1==r.tag){console.log(r.size.width,r.size.height);break}}},nodeRotateAction:function(e,t,o,n){var i=[],r=cc.repeat(cc.rotateBy(t,o),n);i.push(r),i.push(cc.callFunc(function(t){e.rotation=0},self,null)),e.runAction(new cc.Sequence(i))},leftBigRoll:function(e,t){var o=[],n=null;n=cc.repeat(cc.rotateBy(.1,-60),1),o.push(n),n=cc.repeat(cc.rotateBy(.35,-360),1),o.push(n),n=cc.repeat(cc.rotateBy(.1,60),1),o.push(n),o.push(cc.callFunc(function(o){e.rotation=0,t.setCanChangeLane(!0)},self,null)),e.runAction(new cc.Sequence(o))},rightBigRoll:function(e,t){var o=[],n=null;n=cc.repeat(cc.rotateBy(.1,60),1),o.push(n),n=cc.repeat(cc.rotateBy(.35,360),1),o.push(n),n=cc.repeat(cc.rotateBy(.1,-60),1),o.push(n),o.push(cc.callFunc(function(o){e.rotation=0,t.setCanChangeLane(!0)},self,null)),e.runAction(new cc.Sequence(o))},rollBigOrSmall:function(e){var t=[{limit:10+3*e,result:!0},{limit:100,result:!1}],o=UTIL.randInt(0,100);return t[UTIL.inRange(o,t)].result}});o.clsBlock=n,cc._RF.pop()},{}],car:[function(e,t,o){"use strict";cc._RF.push(t,"0396baqIXFJY6t/bMDVO3ZL","car"),cc.Class({extends:cc.Component,properties:{carIndex:{default:1,type:cc.Integer,visible:!0},speedUp:cc.Node,_speed:0,carTag:null,gears:[],_speedMax:0,canMove:!0,canChangeLane:!0,audioBomb:{type:cc.AudioSource,default:null},audioRun:{type:cc.AudioSource,default:null},audioSmallCrash:{type:cc.AudioSource,default:null},audioBigCrash:{type:cc.AudioSource,default:null}},start:function(){cc.find("boom",this.node).active=!1,this.gears=[];for(var e=0;e<MAX_GEAR-1;++e)this.gears[e]=(e+1)*SPEED_UP_PER_GEAR;this._speedMax=this.gears[MAX_GEAR-4],cc.director.getCollisionManager().enabled=!0},setCarTag:function(e){this.carTag=e+1},setCarIndex:function(e){this.carIndex=e,UI.changeFrame(this.node,"game/car"+e)},setSpeed:function(e){this.canMove&&(e<0&&(e=0),this._speed=e)},setCanMove:function(e){this.canMove=e},changeX:function(e){0!=this.canMove&&(this.node.x+=e)},getSpeedMax:function(){return this._speedMax},setSpeedMax:function(){this._speedMax=this.gears[MAX_GEAR-4]},setSpeedUpMax:function(){this._speedMax=this.gears[this.gears.length-1]},setCanChangeLane:function(e){this.canChangeLane=e},getCanChangeLane:function(){return this.canChangeLane},getSpeedUpMax:function(){return this.gears[this.gears.length-1]},getGears:function(){return this.gears},getNowGear:function(){return Math.floor(this._speed/SPEED_UP_PER_GEAR)+1},changeSpeed:function(e){this.canMove&&(this._speed+=e,this._speed<=0&&(this._speed=0),this._speed=this._speed>this._speedMax?this._speedMax:this._speed)},getSpeed:function(){return this._speed},playSmallCrashSound:function(){var e=this,t=cc.find("audioSmallCrash",this.node);t.stopAllActions(),t.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){e.audioSmallCrash.play()})))},playBigCrashSound:function(){var e=this,t=cc.find("audioBigCrash",this.node);t.stopAllActions(),t.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){e.audioBigCrash.play()})))},bomb:function(){var e=this;if(e.speedUp.acitve=!1,0!=e.canMove){e.node.stopAllActions(),cc.director.getCollisionManager().enabled=!1,e.node.rotation=0,e.audioBomb&&e.audioBomb.play(),e.setSpeed(0),e.canMove=!1;var t=cc.find("boom",this.node),o=[];o.push(cc.delayTime(EXPLODE_PRE_TIME)),o.push(cc.callFunc(function(o){e.node.getComponent(cc.Sprite).spriteFrame=null,t.active=!0,this.node.getComponent(cc.Animation).play("boom")},e,null)),o.push(cc.delayTime(.3)),o.push(cc.callFunc(function(o){e.node.x=0,e.node.rotation=0,e.node.getComponent(cc.Sprite).spriteFrame=null,t.active=!1,UI.changeFrame(e.node,"game/car"+e.carIndex)},e,null)),o.push(cc.blink(EXPLODE_BLINK_DT,EXPLODE_BLINK_TIME)),o.push(cc.callFunc(function(t){e.canMove=!0,e.canChangeLane=!0,cc.director.getCollisionManager().enabled=!0},e,null)),e.node.runAction(new cc.Sequence(o))}},update:function(e){var t=this;if(t.carTag==t.carIndex){if(t.speedUp.active=!1,t.audioRun.volume=.65+.05*t.getNowGear(),0!=t.canMove)return t._speed>t.gears[MAX_GEAR-4]?(t.speedUp.active=!0,t.node.getComponent(cc.Sprite).spriteFrame=null,void(0==t.node.rotation?(t.audioRun.isPlaying||t.audioRun.play(),UI.changeFrame(t.speedUp,"game/car"+t.carIndex+"_3")):(t.audioRun.stop(),UI.changeFrame(t.speedUp,"game/car"+t.carIndex)))):t._speed>=t.gears[3]?(t.speedUp.active=!0,t.node.getComponent(cc.Sprite).spriteFrame=null,void(0==t.node.rotation?(t.audioRun.isPlaying||t.audioRun.play(),UI.changeFrame(t.speedUp,"game/car"+t.carIndex+"_2")):(t.audioRun.stop(),UI.changeFrame(t.speedUp,"game/car"+t.carIndex)))):(t._speed>0?t.audioRun.isPlaying||t.audioRun.play():t.audioRun.stop(),void UI.changeFrame(t.node,"game/car"+t.carIndex));t.audioRun.stop()}else t.audioRun.stop()}}),cc._RF.pop()},{}],game:[function(e,t,o){"use strict";cc._RF.push(t,"2469cpVsGtEKZt/V+HQNrBx","game"),e("init");cc.Class({extends:cc.Component,properties:{_heroId:0,_heroCarIndex:0,_opponentCarIndex:0,_plyaerIds:[0,0],_counter:0,_frameCount:99999999,_distances:[0,0],_offsetXMin:-200,_offsetXMax:200,_presentY:710,_presentX:0,_waywidth:0,initOffsetXs:[0,0],initOffsetY:-250,_offsetXs:[0,0],_accelerator:!1,_changelane:!1,running:!1,trafficlightIndex:0,_destination:0,maskLayer:cc.Node,roadNode:cc.Node,bg1:cc.Sprite,bg2:cc.Sprite,startLine:cc.Sprite,redpoint:cc.Sprite,bluepoint:cc.Sprite,cars:{default:[],type:cc.Sprite},heroArrow:cc.Sprite,_blocks:[],speedometer:cc.ProgressBar,speedLabel:cc.Label,speedupButton:cc.Button,wheelButton:cc.Button,tipsLabel:cc.Label,trafficlight:cc.Node,trafficlights:{default:[],type:cc.Sprite},audioBackground:{url:cc.AudioClip,default:null},audioDaoshu:{type:cc.AudioSource,default:null},audioWin:{url:cc.AudioClip,default:null},audioLose:{url:cc.AudioClip,default:null}},onLoad:function(){YYSDK.JYXStartGame(),YYSDK.JYXFinishLoading()},start:function(){var e=this;UI.setSwallow(this,this.maskLayer),e.initOffsetXs=[-125,125],e.initOffsetY=-250,e._offsetXs=[-125,125],e._destination=ROAD_LENGTH,e._frameCount=0,e._waywidth=200,e._presentX=30,e.bindEvent(),NETWORK.initProtocols(),this.scheduleOnce(function(){NETWORK.connect(WS_URL)},2);this.schedule(function(){NETWORK.isConnected()&&for_caller.s_user_heartbeat()},5,999999,5)},reset:function(){var e=this;e.maskLayer.active=!0,e.prepare()},prepare:function(){for(var e=this,t=0;t<e.cars.length;t++){var o=e.cars[t];o.getComponent("car").setCarIndex(t+1),o.node.x=e.initOffsetXs[t],o.node.y=-400,o.node.runAction(cc.moveTo(.5,o.node.x,e.initOffsetY))}e._distances=[0,0],e.heroArrow.node.x=e.initOffsetXs[e._heroCarIndex],this.cars[e._heroCarIndex].getComponent("car").setCarTag(e._heroCarIndex),e.heroArrow.node.active=!0,e.startLine.node.y=-150,e.speedometer.progress=0,e.tipsLabel.string="并驾齐驱",e.trafficlight.active=!0;for(var n=0;n<e.trafficlights.length;n++)e.trafficlights[n].node.active=!1},countdown:function(){var e=this;e.maskLayer.active=!1,e.trafficlightIndex=0,e.running=!1;e.schedule(function(){for(var t=0;t<e.trafficlights.length;t++)e.trafficlights[t].node.active=t===e.trafficlightIndex;console.log("****play countdown"),e.audioDaoshu.stop(),e.audioDaoshu.play(),e.trafficlightIndex+=1,4===e.trafficlightIndex&&(e.trafficlight.active=!1,e.heroArrow.node.active=!1,e.running=!0,YYSDK.JYXPKStart())},1,3,1)},bindEvent:function(){var e=this,t=this.cars[e._heroCarIndex].getComponent("car");e.speedupButton.node.on("touchstart",function(t){e._accelerator=!0},e),e.speedupButton.node.on("touchend",function(t){e._accelerator=!1},e),e.speedupButton.node.on("touchcancel",function(t){e._accelerator=!1},e),e.wheelButton.node.on("touchstart",function(t){var o=t.getLocation();o.x>=233&&(e._changelane=SPEED_HORIZON/60),o.x<=149&&(e._changelane=-SPEED_HORIZON/60)},e),e.wheelButton.node.on("touchmove",function(t){var o=t.getLocation();o.x>=233&&(e._changelane=SPEED_HORIZON/60),o.x<=149&&(e._changelane=-SPEED_HORIZON/60)},e),e.wheelButton.node.on("touchend",function(t){e._changelane=0},e),e.wheelButton.node.on("touchcancel",function(t){e._changelane=0},e),e.eventFuncs={ENTER:function(t){var o=t.detail;e._heroId=o.heroId},START:function(t){var o=t.detail;e._plyaerIds=[o.ownerId,o.opponentId],e._heroCarIndex=e._plyaerIds.indexOf(e._heroId),e._opponentCarIndex=0==e._heroCarIndex?1:0,e.prepare(),e.countdown()},FINISH:function(t){e.reset()},RACE:function(t){var o=t.detail;e._distances[e._opponentCarIndex]=o.distance,e._offsetXs[e._opponentCarIndex]=o.x},RESULT:function(o){t.setSpeed(0),t.setCanMove(!1);var n=o.detail,i=function(e){var t=Math.floor(e/1e3),o=e%1e3;o=o.toString().substr(0,2);var n=Math.floor(t/60);return t%=60,n>99&&(n=99),n<10&&(n="0"+n.toString()),t<10&&(t="0"+t.toString()),e=n+":"+t+":"+o};n.winnerId==e._heroId?(e.running=!1,cc.audioEngine.play(e.audioWin,!1,1),UI.show(null,"prefab/result_win",function(e){var t=i(n.time);e.getComponent("result").showTime(t)})):(e.running=!1,cc.audioEngine.play(e.audioLose,!1,1),UI.show(null,"prefab/result_lose",function(e){var t=i(n.time);e.getComponent("result").showTime(t)})),e.scheduleOnce(function(){console.log(n.result),YYSDK.JYXPKFinish(n.result)},2)},BLOCK:function(t){var o=t.detail.blockData,n=o.type;!function(t,o,n){UI.show(e.roadNode,t,function(t){t.getComponent(o).updateData(n),e._blocks.push(t),t.x=n.x,t.y=n.y})}("prefab/block"+n,"block"+n,o)}};for(var o in e.eventFuncs){var n=e.eventFuncs[o];cc.director.on(o,n)}},genBlockDatas:function(){var e=this;if(e._frameCount>0)e._frameCount-=1;else{var t=UTIL.randInt(0,100),o=UTIL.inRange(t,BLOCK_CONFIG),n=BLOCK_CONFIG[o],i=n.blockType,r=n.speed,a={type:i,x:UTIL.randInt(-125,125),y:700,speed:r};if(cc.director.emit("BLOCK",{blockData:a}),e._frameCount<=0){t=UTIL.randInt(BLOCK_SHOW_INTERVAL_MIN,BLOCK_SHOW_INTERVAL_MAX);e._frameCount=Math.floor(t/60)}}},adjustRoad:function(){var e=this,t=this.cars[e._heroCarIndex].getComponent("car").getSpeed(),o=void 0,n=void 0;e.bg1.node.y<e.bg2.node.y?(o=e.bg2,n=e.bg1):(o=e.bg1,n=e.bg2);if(n.node.y=n.node.y-t,o.node.y=n.node.y+1334,n.node.y<-1334&&(n.node.y=o.node.y+1334),e.startLine.node.y=e.startLine.node.y-t,e.startLine.node.y<-700){var i=e.cars[e._heroCarIndex];e.startLine.node.y=i.node.y+(e._destination-e._distances[e._heroCarIndex])}for(var r=[],a=0;a<e._blocks.length;a++){var c=e._blocks[a],s=c.getComponent("block").getSpeed();if(c.y=c.y-t+s,c.y<-1334||c.y>1334){r.push(c);var l=e._blocks.indexOf(c);e._blocks.splice(l,1)}}if(r.length>0)for(var d=0;d<r.length;d++){var h=r[d];2!=h.getComponent("block").getType()&&h.destroy()}r=[]},mapWeiYi:function(e,t){var o=this,n=e/o._destination*o._presentY,i=t.node.x/o._waywidth*o._presentX,r=o._distances[o._opponentCarIndex]/o._destination*o._presentY,a=o._offsetXs[o._opponentCarIndex]/o._waywidth*o._presentX;0==o._heroCarIndex&&(o.redpoint.node.y=-350+n,o.redpoint.node.x=i,o.bluepoint.node.y=-350+r,o.bluepoint.node.x=a),1==o._heroCarIndex&&(o.bluepoint.node.y=-350+n,o.bluepoint.node.x=i,o.redpoint.node.y=-350+r,o.redpoint.node.x=a)},update:function(e){var t=this,o=this.cars[t._heroCarIndex].getComponent("car"),n=!0,i=this.cars[t._heroCarIndex].node.x;if((i<=t._offsetXMin||i>=t._offsetXMax)&&(o.setCanChangeLane(!1),o.bomb()),!1!==t.running){var r=o.getSpeed();o.getSpeedMax();o.getNowGear()>BLOCK_SHOW_GEER&&t.genBlockDatas(),0==o.getCanChangeLane()&&(n=!1),t._accelerator&&n?o.changeSpeed(SPEED_UP_PER_FRAME):r>0&&o.changeSpeed(SPEED_DOWN_PER_FRAME),r=o.getSpeed(),t.adjustRoad();var a=t._distances[t._heroCarIndex];a+=r,t._distances[t._heroCarIndex]=a;var c=a-t._distances[t._opponentCarIndex];t.tipsLabel.string=0===c?"齐驱并驾":c>0?"领先"+Math.round(c/100)+"米":"落后"+Math.abs(Math.round(c/100))+"米";var s=t.cars[t._heroCarIndex];if(0!==t._changelane&&0!=o.getCanChangeLane()){var l=s.node.x;l=(l=(l+=t._changelane)<t._offsetXMin?t._offsetXMin:l)>t._offsetXMax?t._offsetXMax:l,s.node.x=l}var d=t.cars[t._opponentCarIndex];d.node.x=t._offsetXs[t._opponentCarIndex],d.node.y=s.node.y-c,t.mapWeiYi(a,s),t.speedometer.progress=r/o.getSpeedUpMax(),t.speedLabel.string=Math.floor(3*r)+"",0!=r&&for_caller.s_racing_sync_data(a,s.node.x),t._counter+=1,0!=r&&4!=t._counter||(t._counter=0),a>=t._destination&&(t.running=!1,for_caller.s_racing_finish_game())}},onDestroy:function(){var e=this;for(var t in e.eventFuncs){var o=e.eventFuncs[t];cc.director.off(t,o)}}}),cc._RF.pop()},{init:"init"}],getWsUrl:[function(e,t,o){"use strict";function n(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(t);return null!=o?unescape(o[2]):null}cc._RF.push(t,"123ddSDQcJC4oFdYRNg0NDn","getWsUrl"),window.GetQueryString=n,window.GetWsUrl=function(){var e=n("websocketdomain");if(null===e)return null;var t=n("port"),o=n("sign"),i=n("nonstr"),r=n("timestamp"),a=n("post_data"),c=JSON.parse(a);return"ws://"+e+":"+t+"/"+c.gameid+"/"+c.roomid+"?nonstr="+i+"&sign="+o+"&timestamp="+r+"&post_data="+a},window.GetWssUrl=function(){var e=n("websocketdomain");if(null===e)return null;var t=n("port"),o=n("sign"),i=n("nonstr"),r=n("timestamp"),a=n("post_data"),c=JSON.parse(a);return"wss://"+e+":"+t+"/"+c.gameid+"/"+c.roomid+"?nonstr="+i+"&sign="+o+"&timestamp="+r+"&post_data="+a},cc._RF.pop()},{}],init:[function(e,t,o){"use strict";cc._RF.push(t,"088362lqWtCH7AOZJH1p7sP","init"),e("GameConfig"),window.YYSDK=e("yysdk").YYSDK,window.NETWORK=e("network2"),window.UTIL=e("util"),window.UI=e("ui"),window.WS_URL=YYSDK.GetWssUrl(),cc.log("init->"+WS_URL),null===window.WS_URL&&(window.WS_URL="ws://192.168.1.192:10020"),cc._RF.pop()},{GameConfig:"GameConfig",network2:"network2",ui:"ui",util:"util",yysdk:"yysdk"}],network2:[function(require,module,exports){"use strict";function parseProtocol(e){cc.log("parse filedata:",e);var t=protobuf.parse(e),o=t.package;cc.log("parse package:",o);var n=t.root.lookup(o).toJSON();Object.keys(n.nested).forEach(function(e){var n=t.root.lookup(o+"."+e);cc.log(" | protocol:",e);var i={protocol:n,packageName:o,fieldNames:[]};protocolInfos[e]=i,Object.keys(n.fields).forEach(function(t){cc.log(" |-- field:",t),protocolInfos[e].fieldNames.push(t)}),e.startsWith("s_")&&(cc.log("init protocol:",e),for_caller[e]=function(){if(isConnect){for(var t=arguments.length,o=Array(t),n=0;n<t;n++)o[n]=arguments[n];console.assert(o.length==i.fieldNames.length);for(var r={},a=0;a<i.fieldNames.length;a++)r[i.fieldNames[a]]=o[a];var c=i.protocol.encode(r).finish(),s=e+"|"+base64.encode(c,0,c.length);socket.send(s)}else cc.log("> 连接已断开")})})}function initProtocols(){for(var e=["./protocol/login","./protocol/user","./protocol/racing"],t=0,o=e.length;t<o;t++){var n=e[t];cc.loader.loadRes(n,function(e,t){parseProtocol(t)})}}cc._RF.push(module,"bca2eH6NsNMMLWv/u8ClSay","network2");var base64=protobuf.util.base64,PROTOCOL_PATH="./protocol",for_maker={},for_caller={};window.for_maker=for_maker,window.for_caller=for_caller,require("binding");var socket=null,isConnect=!1,isProtocolInited=!1,protocolInfos={};exports.initProtocols=function(){isProtocolInited||(isProtocolInited=!0,initProtocols())},exports.connect=function(url){cc.log("connect->"+url),socket=new WebSocket(url),socket.onopen=function(){isConnect=!0,cc.log("服务器已连接"),for_caller.s_login_version(1)},socket.onmessage=function(e){var message=e.data;console.log("received: %s",message);var datas=message.split("|");if(2==datas.length){var protocolName=datas[0];if(for_maker[protocolName]){var map=protocolInfos[protocolName],data=datas[1],decodeArray=new Uint8Array(base64.length(data));base64.decode(data,decodeArray,0);var args=map.protocol.decode(decodeArray);cc.log("> "+protocolName+": "+JSON.stringify(args));for(var argValues=[],i=0;i<map.fieldNames.length;i++){var argName=map.fieldNames[i];argValues.push("args."+argName)}var code="for_maker[protocolName]("+argValues.join(", ")+");";eval(code)}}},socket.onclose=function(){isConnect=!1,cc.log("服务器已断开连接"),cc.director.emit("FINISH",{})},socket.onerror=function(e){isConnect=!1,cc.log("服务器链接错误"),cc.director.emit("FINISH",{})}},exports.isConnected=function(){return isConnect},cc._RF.pop()},{binding:"binding"}],network:[function(require,module,exports){"use strict";function parseProtocol(e){cc.log("parse filedata:",e);var t=protobuf.parse(e),o=t.package;cc.log("parse package:",o);var n=t.root.lookup(o).toJSON();Object.keys(n.nested).forEach(function(e){var n=t.root.lookup(o+"."+e);cc.log(" | protocol:",e);var i={protocol:n,packageName:o,fieldNames:[]};protocolInfos[e]=i,Object.keys(n.fields).forEach(function(t){cc.log(" |-- field:",t),protocolInfos[e].fieldNames.push(t)}),e.startsWith("s_")&&(cc.log("init protocol:",e),for_caller[e]=function(){if(isConnect){for(var t=arguments.length,o=Array(t),n=0;n<t;n++)o[n]=arguments[n];console.assert(o.length==i.fieldNames.length);for(var r={},a=0;a<i.fieldNames.length;a++)r[i.fieldNames[a]]=o[a];var c=i.protocol.encode(r).finish();socket.emit(e,base64.encode(c,0,c.length))}else cc.log("> 连接已断开")})})}function initProtocols(){for(var e=["./protocol/login","./protocol/user","./protocol/racing"],t=0,o=e.length;t<o;t++){var n=e[t];cc.loader.loadRes(n,function(e,t){parseProtocol(t)})}}cc._RF.push(module,"0c4ffFXrllH4aqHOUH/ahl4","network");var base64=protobuf.util.base64,PROTOCOL_PATH="./protocol",for_maker={},for_caller={},socket=null,isConnect=!1,isProtocolInited=!1,protocolInfos={};exports.initProtocols=function(){isProtocolInited||(isProtocolInited=!0,initProtocols())},exports.connect=function(url){cc.sys.isNative&&(window.io=SocketIO.connect),cc.log("wsURL->"+url),(socket=io(url)).on("disconnect",function(){isConnect=!1,cc.log("服务器已断开连接")}),socket.on("connect",function(){isConnect=!0,cc.log("服务器已连接"),for_caller.s_login_version(1)}),Object.keys(protocolInfos).forEach(function(protocolName){var map=protocolInfos[protocolName];protocolName.startsWith("c_")&&(cc.log("init protocol:",protocolName),socket.on(protocolName,function(data){var decodeArray=new Uint8Array(base64.length(data));base64.decode(data,decodeArray,0);var data=map.protocol.decode(decodeArray);if(cc.log("> "+protocolName+": "+JSON.stringify(data)),for_maker[protocolName]){for(var argValues=[],i=0;i<map.fieldNames.length;i++){var argName=map.fieldNames[i];argValues.push("data."+argName)}var code="for_maker[protocolName]("+argValues.join(", ")+");";eval(code)}}))})},exports.isConnected=function(){return isConnect},cc._RF.pop()},{}],result:[function(e,t,o){"use strict";cc._RF.push(t,"5ace6iSrztHMa9vp95MhOJ4","result"),cc.Class({extends:cc.Component,properties:{timeLabel:cc.Label},start:function(){},showTime:function(e){this.timeLabel.string=e}}),cc._RF.pop()},{}],ui:[function(e,t,o){"use strict";cc._RF.push(t,"cb370IUSFJJNIJ4k3sNZ7Iz","ui"),o.show=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;cc.loader.loadRes(t,function(t,n){var i=cc.instantiate(n);null===e&&(e=cc.director.getScene()),e.addChild(i),null!==o&&o(i)})},o.setSwallow=function(e,t){t.on("touchstart",function(e){e.stopPropagation()})},o.changeFrame=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.getComponent(cc.Sprite);cc.loader.loadRes(t,cc.SpriteFrame,function(e,t){n.spriteFrame=t,null!==o&&o(n)})},cc._RF.pop()},{}],util:[function(e,t,o){"use strict";cc._RF.push(t,"ddac2uUcSNH1r9eE2wjeTxP","util"),o.randInt=function(e,t){var o=t-e,n=Math.random();return e+Math.round(n*o)},o.inRange=function(e,t){for(var o in t){var n=t[o].limit;if(null!==n&&e<n)return o}return t.length-1},o.randRange=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"limit",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=[],i=0;Object.keys(e).forEach(function(o){var r=e[o],a=r[t],c={limit:i+=a,info:r};n.push(c)}),i=null!==o?o:i;var r=UTIL.randInt(0,i),a=UTIL.inRange(r,n);return n[a].info},cc._RF.pop()},{}],yysdk:[function(e,t,o){"use strict";function n(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(t);return null!=o?decodeURIComponent(o[2]):null}function i(){var e=n("post_data");return decodeURI(e)}cc._RF.push(t,"7e73fRKnghN/rQPHAN8dmE2","yysdk");var r={GetWsUrl:function(){var e=n("websocketdomain");if(null===e)return null;var t=n("port"),o=n("sign"),i=n("nonstr"),r=n("timestamp"),a=n("post_data"),c=JSON.parse(a);return"ws://"+e+":"+t+"/"+c.gameid+"/"+c.roomid+"?nonstr="+i+"&sign="+o+"&timestamp="+r+"&post_data="+a},GetWssUrl:function(){var e=n("websocketdomain");if(null===e)return null;var t=n("port"),o=n("sign"),i=n("nonstr"),r=n("timestamp"),a=n("post_data"),c=JSON.parse(a);return"wss://"+e+":"+t+"/"+c.gameid+"/"+c.roomid+"?nonstr="+i+"&sign="+o+"&timestamp="+r+"&post_data="+a},JYXStartGame:function(){null!=window.nativeApp&&null!=window.nativeApp.onPKLoading&&window.nativeApp.onPKLoading("{}")},JYXFinishLoading:function(){null!=window.nativeApp&&null!=window.nativeApp.onPKFinishLoading&&window.nativeApp.onPKFinishLoading("{}")},JYXLoadFail:function(){null!=window.nativeApp&&null!=window.nativeApp.onPKLoadFail&&window.nativeApp.onPKLoadFail("{}")},JYXPKStart:function(){null!=window.nativeApp&&null!=window.nativeApp.onPKStart&&window.nativeApp.onPKStart("{}")},JYXPKFinish:function(e){if(null==window.nativeApp||null==window.nativeApp.onPKFinish)try{TZOpen.getResult(e)}catch(e){}else window.nativeApp.onPKFinish(e)},JYXInfo:function(e){null!=window.nativeApp&&window.nativeApp.logInfo(e)},JYXError:function(e){null!=window.nativeApp&&window.nativeApp.logError(e)},getSignData:function(){var e=n("timestamp"),t=n("nonstr"),o=n("sign"),i=n("post_data");return e&&t&&o&&i?{timestamp:e,nonstr:t,sign:o,post_data:i}:null},getGameData:function(){var e=i();if(e)try{return e=JSON.parse(e)}catch(e){return null}return null},getRoomId:function(){var e=this.getGameData();return e?e.roomid:0},getPlayer:function(){var e=this.getGameData();return e?e.player:null}};o.YYSDK=r,cc._RF.pop()},{}]},{},["GameConfig","network","network2","util","block","block1","block2","block3","block4","block5","car","game","result","ui","init","binding","getWsUrl","yysdk"]);